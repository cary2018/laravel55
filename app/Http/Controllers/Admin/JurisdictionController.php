<?php/** * Created by PhpStorm. * User: asusa * Date: 2018/6/14/0014 * Author: Cary.He * Contact QQ  : 373889161($S$-Memory) * email: 373889161@qq.com * Time: 09:49 */namespace App\Http\Controllers\Admin;use App\Http\Model\Jurisdiction;use Illuminate\Support\Facades\Input;use Illuminate\Support\Facades\Validator;class JurisdictionController extends BaseController{    public function index()    {        $data = Jurisdiction::orderBy('id','desc')->paginate(10);        return view('admin.jurisdiction.index',compact('data'));    }    public function create()    {        return view('admin.jurisdiction.add');    }    public function store()    {        $input = Input::except('_token');        if(array_key_exists('status',$input))        {            $input['status'] = $input['status'];        }else{            $input['status'] = 0;        }        $input['update_time'] = time();        $input['created_time'] = time();        $ruls = [            'title' => 'required',            'urls' => 'required',        ];        $message = [            'title.required' => '权限名称不能为空！',            'urls.required' => '权限地址不能为空！',        ];        $validator = Validator::make($input,$ruls,$message);        if($validator->passes())        {            $input['urls'] = json_encode(explode('\r',trim($input['urls'])));            Jurisdiction::create($input);            return redirect('admin/jurisdiction');        }else{            return back()->withErrors($validator);        }    }    public function edit($id)    {        $field = Jurisdiction::find($id);        return view('admin.jurisdiction.edit',compact('field'));    }    public function update($id)    {        $input = Input::except('_token','_method');        $input = array_filter($input);        $input['update_time'] = time();        if(array_key_exists('urls',$input))        {            $ar = explode("\n",trim($input['urls']));            $input['urls'] = json_encode($ar);        }        //dd($input);        if(array_key_exists('status',$input))        {            $input['status'] = $input['status'];        }else{            $input['status'] = 0;        }        $relus = [            'title' => 'required',            'urls' => 'required',        ];        $message = [            'title.required' => '权限名称不能为空！',            'urls.required' => '权限地址不能为空！'        ];        //dd($input);        $value = Validator::make($input,$relus,$message);        if($value->passes())        {            $re = Jurisdiction::where('id',$id)->update($input);            if ($re) {                return redirect('admin/jurisdiction');            } else {                return back()->with('errors', '数据未发生变化！！');            }        }else{            return back()->withErrors($value);        }    }    /**     * @param $id     * @return array     * @throws \Exception     *     */    public function destroy($id)    {        $re = Jurisdiction::where('id',$id)->delete();        if ($re)        {            $data = [                'status'=>0,                'msg'=>'删除成功！'            ];        }else{            $data = [                'status'=>1,                'msg'=>'删除失败，请稍后再试！'            ];        }        return $data;    }    public function changeJurisdiction()    {        $input = Input::except('_token');        $nav = Jurisdiction::find($input['id']);        if($input['status']==0)        {            $nav->status = 1;        }else{            $nav->status = 0;        }        $re = $nav->update();        if($re)        {            $data = Jurisdiction::find($input['id'],['id','status']);            $result = [                'status'=>$data->status,                'msg' => '状态更新成功！'            ];        }else{            $result = [                'status'=>$data->status,                'msg' => '状态更新失败！'            ];        }        return $result;    }}