<?php/** * Created by PhpStorm. * User: asusa * Date: 2018/4/11/0011 * Author: Cary.He * Contact QQ  : 373889161($S$-Memory) * email: 373889161@qq.com * Time: 15:54 */namespace App\Http\Controllers\Admin;use App\Http\Controllers\Controller;use App\Http\Model\Article;use App\Http\Model\Category;use Illuminate\Support\Facades\Input;use Illuminate\Support\Facades\Validator;class ArticleController extends Controller{    /**     * @return $this     * 分类列表     */    public function index()    {        $data = Article::leftJoin('category', 'article.cate_id', '=', 'category.cate_id')->orderBy('art_id', 'desc')->paginate(10);        return view('admin.article.index')->with('data',$data);    }    /**     * @return $this     * 添加文章栏目页面     */    public function create()    {        $categorys = Category::all();        $data = (new Category())->getTree($categorys,'cate_name','cate_pid');        $data = (new Category())->array_one($data);        return view('admin.article.add')->with('data',$data);    }    /**     * @return $this|\Illuminate\Http\RedirectResponse|\Illuminate\Routing\Redirector     * 执行添加文章栏目操作     */    public function store()    {        $input = Input::except('_token');        $input = array_filter($input);        $input['art_add_time'] = time();        $input['art_uptime'] = time();        $rules = [            'art_title' => 'required',            'art_content' => 'required',        ];        $messages = [            'art_title.required'=>'标题不能为空！',            'art_content.required'=>'内容不能为空！',        ];        $validator = Validator::make($input,$rules,$messages);        if($validator->passes()){            $re = Article::create($input);            if ($re)            {                return redirect('admin/article');            }else{                return back()->with('errors', '添加失败，请重新添加！');            }        }else{            return back()->withErrors($validator);        }    }    /**     * @param $id     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View     * 编辑文章栏目信息     */    public function edit($id)    {        $categorys = Category::all();        $data = (new Category())->getTree($categorys,'cate_name','cate_pid');        $data = (new Category())->array_one($data);        $field = Article::find($id);        return view('admin.article.edit',compact('field','data'));    }    /**     * @param $id     * @return \Illuminate\Http\RedirectResponse|\Illuminate\Routing\Redirector     * 提交更新文章     */    public function update($id)    {        $input = Input::except('_token','_method');        $input = array_filter($input);        $input['art_uptime'] = time();        $re = Article::where('art_id',$id)->update($input);        if ($re)        {            return redirect('admin/article');        }else{            return back()->with('errors', '数据未发生变化！！');        }    }    /**     * @param $art_id     * @return array     * @throws \Exception     * 删除文章     */    public function destroy($art_id)    {        $re = Article::where('art_id',$art_id)->delete();        if ($re)        {            $data = [                'status'=>0,                'msg'=>'文章删除成功！'            ];        }else{            $data = [                'status'=>1,                'msg'=>'文章删除失败，请稍后再试！'            ];        }        return $data;    }}