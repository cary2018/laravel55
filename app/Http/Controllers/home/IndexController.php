<?php/** * Created by PhpStorm. * User: asusa * Date: 2018/4/25/0025 * Author: Cary.He * Contact QQ  : 373889161($S$-Memory) * email: 373889161@qq.com * Time: 12:06 */namespace App\Http\Controllers\home;use App\Http\Model\Article;use App\Http\Model\Category;use Illuminate\Support\Facades\Input;class IndexController extends PublicController{    public function index()    {        //点击量最高的6篇文章        $hot = Article::orderBy('art_view','desc')->take(7)->get();        //图片列表5篇带分页        $data = Article::where('cate_id','!=',0)->orderBy('art_add_time','desc')->paginate(5);        return view('home.index',compact('hot','data'));    }    /**     * @param $cate_id     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View     * 文章分类     */    public function cate($cate_id)    {        $field = Category::find($cate_id);        if(!$field){            return redirect('/');        }        $data = Article::where('cate_id',$cate_id)->orderBy('art_add_time','desc')->paginate(10);        $submenu = Category::all();        $submenu = (new Category())->getTree($submenu,'cate_name','cate_pid',$cate_id);        $submenu = (new Category())->array_one($submenu);        Category::where('cate_id',$cate_id)->increment('cate_view');        return view('home.list',compact('data','field','submenu'));    }    public function search()    {        $key = Input::get('k');        $data = Article::where(function($q)use($key){            if($key){                $q->where('art_title','like','%'.$key.'%');            }        })->orderBy('art_add_time','desc')->paginate(10);        return view('home.search',compact('data','key'));    }    /**     * @param $art_id     * @return \Illuminate\Contracts\View\Factory|\Illuminate\View\View     * 文章详情页     */    public function article($art_id)    {        $data = Article::join('category','article.cate_id','=','category.cate_id')->where('art_id',$art_id)->first();        if(!$data){            return redirect('/');        }        $art['pre'] = Article::where('art_id','<',$art_id)->orderBy('art_id','desc')->first();        $art['next']= Article::where('art_id','>',$art_id)->orderBy('art_id','asc')->first();        $field = Article::where('cate_id',$data->cate_id)->orderBy('art_id','desc')->take(6)->get();        Article::where('art_id',$art_id)->increment('art_view');        return view('home.new',compact('data','art','field'));    }}