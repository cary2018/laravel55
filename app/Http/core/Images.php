<?php/** * Created by PhpStorm. * User: asusa * Date: 2018/5/3/0003 * Author: Cary.He * Contact QQ  : 373889161($S$-Memory) * email: 373889161@qq.com * Time: 14:59 */namespace App\Http\core;//图片处理工具类use Illuminate\Support\Facades\Input;class Images{    /**     * @param $filename  传入的表单名     * @param $w         宽     * @param $h         高     * @return array     返回数组     * 生成等比例缩略图片     */    public function upload($filename, $w, $h)    {        $file = Input::file($filename);        if ($file) {            $allowed_extensions = ["png", "jpg", "gif", "jpeg", "bmp"];            if ($file->getClientOriginalExtension() && !in_array($file->getClientOriginalExtension(), $allowed_extensions)) {                return ['error' => '允许上传文件类型为：gif; *.jpg; *.png;*.jpeg;*.bmp'];                die;            }            if ($file->isValid()) {                //注意 ： linux  系统上要把 uploads 前面的 “/” 去掉，还有 public_path() 也去掉 否则 可能会出错                $file_path = 'uploads/' . date('Y-m-d', time()) . '/';    //上传文件的目录                //判断文件目录是否存在,不存在则创建                if (!is_dir($file_path)) {                    mkdir($file_path, 0777, true);                }                $clientName = $file->getClientOriginalName();    //客户端文件名称..                $entension = $file->getClientOriginalExtension();               //上传文件的后缀                $newName = date('YmdHis') . time() . mt_rand(100, 999) . '.' . $entension;  //重命名上传文件                $path = $file->move($file_path, $newName);             //将文件移动到目录下                if ($path) {                    $new_filename =  $file_path . $newName;                    $thumb_name = 's_' . $newName;                    $this->scalePic($new_filename, $w, $h);                }                return ['b_img' => $file_path . $newName, 's_img' => $file_path . $thumb_name];            }        } else {            return [];        }    }    /**     * @function 等比缩放函数(以保存的方式实现)     * @param string $picname 被缩放的处理图片源     * @param int $maxX 缩放后图片的最大宽度     * @param int $maxY 缩放后图片的最大高度     * @param string $pre 缩放后图片名的前缀名     * @return string 返回后的图片名称(带路径),如a.jpg --> s_a.jpg     */    function scalePic($picname, $maxX = 100, $maxY = 100, $pre = 's_')    {        $info = getimagesize($picname); //获取图片的基本信息        $width = $info[0];//获取宽度        $height = $info[1];//获取高度        //判断图片资源类型并创建对应图片资源        $im = $this->getPicType($info[2], $picname);        //计算缩放比例        $scale = ($maxX / $width) > ($maxY / $height) ? $maxY / $height : $maxX / $width;        //计算缩放后的尺寸        $sWidth = floor($width * $scale);        $sHeight = floor($height * $scale);        //创建目标图像资源        $nim = imagecreatetruecolor($sWidth, $sHeight);        //等比缩放        imagecopyresampled($nim, $im, 0, 0, 0, 0, $sWidth, $sHeight, $width, $height);        //输出图像        $newPicName = $this->outputImage($picname, $pre, $nim);        //释放图片资源        imagedestroy($im);        imagedestroy($nim);        return $newPicName;    }    /**     * function 判断并返回图片的类型(以资源方式返回)     * @param int $type 图片类型     * @param string $picname 图片名字     * @return 返回对应图片资源     */    function getPicType($type, $picname)    {        $im = null;        switch ($type) {            case 1:  //GIF                $im = imagecreatefromgif($picname);                break;            case 2:  //JPG                $im = imagecreatefromjpeg($picname);                break;            case 3:  //PNG                $im = imagecreatefrompng($picname);                break;            case 4:  //BMP                $im = imagecreatefromwbmp($picname);                break;            default:                die("不认识图片类型");                break;        }        return $im;    }    /**     * function 输出图像     * @param string $picname 图片名字     * @param string $pre 新图片名前缀     * @param resourse $nim 要输出的图像资源     * @return 返回新的图片名     */    function outputImage($picname, $pre, $nim)    {        $info = getimagesize($picname);        $picInfo = pathInfo($picname);        $newPicName = $picInfo['dirname'] . '/' . $pre . $picInfo['basename'];//输出文件的路径        switch ($info[2]) {            case 1:                imagegif($nim, $newPicName);                break;            case 2:                imagejpeg($nim, $newPicName);                break;            case 3:                imagepng($nim, $newPicName);                break;            case 4:                imagewbmp($nim, $newPicName);                break;        }        return $newPicName;    }}